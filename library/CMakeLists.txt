CMAKE_MINIMUM_REQUIRED (VERSION 2.8.8) 
MESSAGE(STATUS "CMAKE VERSION ${CMAKE_VERSION}")

SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_CURRENT_SOURCE_DIR}/../cmake ${CMAKE_CURRENT_SOURCE_DIR}/cmake ${HIP_PATH}/cmake ${MIOPEN_PATH}/lib/cmake/miopen)

execute_process(COMMAND ${HIP_PATH}/bin/hipconfig --platform OUTPUT_VARIABLE HIP_PLATFORM)
MESSAGE (STATUS "HIP_PATH : ${HIP_PATH}")

#Make sure HIP is installed in the target system
FIND_PACKAGE(HIP 1.0 REQUIRED)


IF (HIP_PLATFORM MATCHES "hcc")
  INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/include/)
  SET(HIPDNNSRCS "${CMAKE_CURRENT_SOURCE_DIR}/src/hcc_detail/hipDNN_miopen.cpp")
  SET_PROPERTY(SOURCE ${HIPDNNSRCS} APPEND_STRING PROPERTY COMPILE_FLAGS "-I${MIOPEN_PATH}/include")
  LINK_DIRECTORIES(${MIOPEN_PATH}/lib)
  ADD_LIBRARY(hipdnn SHARED  ${HIPDNNSRCS})
  set_target_properties(hipdnn PROPERTIES LINKER_LANGUAGE CXX)
  set_target_properties(hipdnn PROPERTIES LINK_FLAGS "-L${MIOPEN_PATH}/lib")
  TARGET_LINK_LIBRARIES(hipdnn MIOpen)
ENDIF()
  


